<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>shell-通用型单应用的管理工具（start、stop、restart、status） | haydenzhou小木屋</title><meta name="keywords" content="linux,shell"><meta name="author" content="haydenzhou,zhou_kexin(@).foxmail.com**(@)替换为@**"><meta name="copyright" content="haydenzhou"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本文纯属个人观点，喜欢的欢迎交流不喜欢的望放过！在此谢过~">
<meta property="og:type" content="article">
<meta property="og:title" content="shell-通用型单应用的管理工具（start、stop、restart、status）">
<meta property="og:url" content="https://haydenzhou.github.io/2021/10/03/linux-shell-appmanager/index.html">
<meta property="og:site_name" content="haydenzhou小木屋">
<meta property="og:description" content="本文纯属个人观点，喜欢的欢迎交流不喜欢的望放过！在此谢过~">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://haydenzhou.github.io/img/default_cover.png">
<meta property="article:published_time" content="2021-10-03T02:19:32.000Z">
<meta property="article:modified_time" content="2021-10-04T15:13:44.112Z">
<meta property="article:author" content="haydenzhou">
<meta property="article:tag" content="linux">
<meta property="article:tag" content="shell">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://haydenzhou.github.io/img/default_cover.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://haydenzhou.github.io/2021/10/03/linux-shell-appmanager/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'shell-通用型单应用的管理工具（start、stop、restart、status）',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-10-04 23:13:44'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/self-ava.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">32</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">34</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div></div></div><hr/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/default_cover.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">haydenzhou小木屋</a></span><div id="menus"><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">shell-通用型单应用的管理工具（start、stop、restart、status）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-10-03T02:19:32.000Z" title="发表于 2021-10-03 10:19:32">2021-10-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-10-04T15:13:44.112Z" title="更新于 2021-10-04 23:13:44">2021-10-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/linux/">linux</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/linux/shell/">shell</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="shell-通用型单应用的管理工具（start、stop、restart、status）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><blockquote>
<p>最近，在服务器部署natapp时，需要nohup启动，但是官方并没有提供管理脚本。自己手动进行nohup启动并且需要配置token、log等比较麻烦，并且状态查看、关闭、重启等都比较繁琐。而我比较懒<img src="./lazy.gif" alt="img">,所以思考有没有一种脚本可以满足我的需求，实现通用程序的脚本话管理，于是进行百度，果然找到相关的工具，果然很多人都很懒惰(#^.^#)。在脚本使用过程中还有部分问题，于是进行了改进实现，将整个过程记录下来，以供后续优化与改进。</p>
</blockquote>
<h1 id="使用说明"><a href="#使用说明" class="headerlink" title="使用说明"></a>使用说明</h1><blockquote>
<p>脚本编写参照，systemctl、service进行应用的管理配置进行编写。<br>脚本使用步骤：</p>
<ul>
<li>第一步，根据说明完成应用名称、应用目录、以及启动指令配置；</li>
<li>第二步，运行【sh app.sh debug】进行参数的调试检查；</li>
<li>第三步，进行应用的启动、状态查看等使用。【sh app.sh start/stop/status/restart/debug】</li>
</ul>
</blockquote>
<h1 id="脚本解析"><a href="#脚本解析" class="headerlink" title="脚本解析"></a>脚本解析</h1><h2 id="涉及技术"><a href="#涉及技术" class="headerlink" title="涉及技术"></a>涉及技术</h2><ul>
<li><h3 id="ANSI转义序列"><a href="#ANSI转义序列" class="headerlink" title="ANSI转义序列"></a>ANSI转义序列</h3><blockquote>
<p><strong>ANSI转义序列</strong>是一种带内信号的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E8%BD%AC%E4%B9%89%E5%BA%8F%E5%88%97">转义序列</a>标准，用于控制视频文本<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E7%BB%88%E7%AB%AF">终端</a>上的光标位置、颜色和其他选项。在文本中嵌入确定的字节序列，大部分以<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/ESC">ESC</a><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E8%BD%AC%E4%B9%89%E5%AD%97%E7%AC%A6">转义字符</a>和”[“字符开始，终端会把这些字节序列解释为相应的指令，而不是普通的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81">字符编码</a>。</p>
</blockquote>
<h4 id="相关材料："><a href="#相关材料：" class="headerlink" title="相关材料："></a>相关材料：</h4><p><a target="_blank" rel="noopener" href="http://blog.chinaunix.net/uid-25365622-id-4251626.html">Linux终端ANSI控制码–转义序列</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/790fc612aaa5">terminal color - 终端颜色控制</a></p>
</li>
<li><h3 id="echo指令"><a href="#echo指令" class="headerlink" title="echo指令"></a>echo指令</h3><blockquote>
<p>echo命令的功能是在显示器上显示一段文字，一般起到一个提示的作用。echo 主要有【echo string】普通输出模式和【echo -e string】转义输出模式。</p>
<ul>
<li><p>echo注意点：</p>
<p>echo 普通模式注意调整输出的格式，为了排版好看可以加“”，进行原样输出；</p>
<p>echo -e 模式需注意使用终端配置时，需设置关闭指令【\e[0m】；</p>
</li>
</ul>
</blockquote>
<h4 id="相关材料"><a href="#相关材料" class="headerlink" title="相关材料"></a>相关材料</h4><p> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/karl-python/p/9261920.html">echo -e 命令详解</a></p>
</li>
<li><h3 id="、-、-、’、”、-用法"><a href="#、-、-、’、”、-用法" class="headerlink" title="$、$()、${}、’、”、`用法"></a>$、$()、${}、’、”、`用法</h3><blockquote>
<p>在bash中，<code>$( )</code>与（反引号）都是用来作命令替换的,${ }变量替换</p>
</blockquote>
<h4 id="相关材料-1"><a href="#相关材料-1" class="headerlink" title="相关材料"></a>相关材料</h4><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/number_0_0/article/details/73291182">Linux—shell中$(( ))、$( )、``与${ }的区别</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/taiyang1987912/article/details/39551385">shell中各种括号的作用( )、(( ))、[ ]、[[ ]]、{ }</a></p>
</li>
<li><h3 id="eval"><a href="#eval" class="headerlink" title="eval"></a>eval</h3><blockquote>
<p>Linux eval命令用于重新运算求出参数的内容。</p>
<p>eval可读取一连串的参数，然后再依参数本身的特性来执行。</p>
</blockquote>
<h4 id="相关材料-2"><a href="#相关材料-2" class="headerlink" title="相关材料"></a>相关材料</h4><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/faberbeta/p/linuxshell_eval.html">shell中的eval命令</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/luliuliu1234/article/details/80994391/">Shell 中eval的用法</a></p>
</li>
<li><h3 id="case"><a href="#case" class="headerlink" title="case"></a>case</h3><blockquote>
<p>case … esac 与其他语言中的 switch … case 语句类似，是一种多分枝选择结构。</p>
<p>case 语句匹配一个值或一个模式，如果匹配成功，执行相匹配的命令。</p>
</blockquote>
<h4 id="相关材料-3"><a href="#相关材料-3" class="headerlink" title="相关材料"></a>相关材料</h4><p><a target="_blank" rel="noopener" href="http://c.biancheng.net/cpp/view/7006.html">Shell case esac语句</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/young_gril/article/details/81566747">shell脚本case语句使用</a></p>
</li>
<li><h3 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h3><blockquote>
<p>Linux系统中grep命令是一种强大的文本搜索工具，它能使用正则表达式搜索文本，并把匹 配的行打印出来。grep全称是Global Regular Expression Print，表示全局正则表达式版本，它的使用权限是所有用户。</p>
</blockquote>
<h4 id="相关材料-4"><a href="#相关材料-4" class="headerlink" title="相关材料"></a>相关材料</h4><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/108042597">shell脚本——grep详解</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/metianzing/p/6938473.html">shell–grep命令+正则表达式+基本语法</a></p>
</li>
<li><h3 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h3><blockquote>
<p>awk是一种编程语言，用于在linux/unix下对文本和数据进行扫描与处理。数据可以来自标准输入、文件、管道。</p>
</blockquote>
<h4 id="相关材料-5"><a href="#相关材料-5" class="headerlink" title="相关材料"></a>相关材料</h4><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/cap-rq/p/11411415.html">Shell脚本之awk篇</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/wdz306ling/article/details/80383824">shell脚本–awk的用法</a></p>
</li>
</ul>
<h2 id="颜色定义"><a href="#颜色定义" class="headerlink" title="颜色定义"></a>颜色定义</h2><h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><blockquote>
<p>颜色定义是通过预定义相关输出的样式，实现提示、错误输出、普通输出、结束样式等样式的定义。实现方式通过echo -e以及ANSI转义序列实现。</p>
</blockquote>
<h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义颜色动作, 把echo -e也定义到变量中</span></span><br><span class="line">RED=<span class="string">&quot;echo -en \\E[1;31m&quot;</span>      <span class="comment">#普通红色</span></span><br><span class="line">GREEN=<span class="string">&quot;echo -en \\E[1;32m&quot;</span>	  <span class="comment">#普通绿色</span></span><br><span class="line">YELLOW=<span class="string">&quot;echo -en \\E[1;33m&quot;</span>	  <span class="comment">#普通黄色</span></span><br><span class="line">RESET=<span class="string">&quot;echo -en \\E[0;39m&quot;</span>    <span class="comment">#样式重置</span></span><br></pre></td></tr></table></figure>



<h2 id="标本提示"><a href="#标本提示" class="headerlink" title="标本提示"></a>标本提示</h2><h3 id="作用-1"><a href="#作用-1" class="headerlink" title="作用"></a>作用</h3><blockquote>
<p>脚本提示其实为脚本备注，通过借助预定义的颜色以及脚本的作者、使用说明，通过echo “String”的形式进行原样式输出。</p>
</blockquote>
<h3 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$RED</span> &amp;&amp;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;############  脚本说明 ###############################&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;脚本説明：&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;  本脚本主要用于常用工具的快速查看、启动、关闭&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;  @auth:周可新&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;  @Date:2021年4月17日&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;  详细材料请参照：https://haydenzhou.github.io/&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;使用说明（请先阅读配置使用本脚本说明）：&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;	 1.请先配置脚本配置项：&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;		必配项：appname、appdir、cmd&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;		选配项：output_file&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;	 2.指令sh app.sh 【start|stop|restart|status】&#x27;</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;############  脚本说明 ###############################&#x27;</span> &amp;&amp; <span class="variable">$RESET</span></span><br></pre></td></tr></table></figure>



<h2 id="debug方法"><a href="#debug方法" class="headerlink" title="debug方法"></a>debug方法</h2><h3 id="作用-2"><a href="#作用-2" class="headerlink" title="作用"></a>作用</h3><blockquote>
<p>根据提示设置完相关相关内容，检查设置是否正确。</p>
<p>指令:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh app.sh debug</span><br></pre></td></tr></table></figure>

</blockquote>
<h3 id="定义-2"><a href="#定义-2" class="headerlink" title="定义"></a>定义</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#############  配置项 ###############################</span></span><br><span class="line">appname=<span class="string">&#x27;natapp&#x27;</span> <span class="comment"># 程序名称</span></span><br><span class="line">appdir=<span class="string">&#x27;/data/program/natapp/&#x27;</span> <span class="comment">#应用所在目录</span></span><br><span class="line">keyword=<span class="variable">$&#123;appdir&#125;</span><span class="variable">$&#123;appname&#125;</span>   <span class="comment"># 应用全路径</span></span><br><span class="line">PID=`ps -ef |grep $(<span class="built_in">echo</span> <span class="variable">$keyword</span> | awk -F/ <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span>) | grep -v grep | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class="line">line=<span class="string">&quot;ps -ef | grep <span class="variable">$&#123;keyword&#125;</span>| wc -l&quot;</span>    <span class="comment"># 查看进程是否存在的命令  </span></span><br><span class="line">cmd=<span class="variable">$&#123;keyword&#125;</span><span class="string">&#x27; -authtoken=31b0350cb06afffc  -log=stdout&#x27;</span> <span class="comment"># nohup 执行不要带 输出重定向 和 &amp; ！！！！！！</span></span><br><span class="line">output_file=<span class="string">&#x27;/dev/null&#x27;</span>      <span class="comment">#输出重定向文件</span></span><br><span class="line">pid_file=<span class="variable">$&#123;keyword&#125;</span><span class="string">&#x27;_app.pid&#x27;</span>  <span class="comment">#pid文件 确保唯一且文件夹可写</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############  配置项 end ############################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 打印相关参数进行调试；</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">debug</span></span>()&#123;</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&#x27;打印相关参数调试&#x27;</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&#x27;keyword=&#x27;</span><span class="variable">$keyword</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&#x27;cmd=&#x27;</span><span class="variable">$cmd</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&#x27;pid_file=&#x27;</span><span class="variable">$pid_file</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&#x27;line=&#x27;</span>;	<span class="built_in">eval</span> <span class="variable">$line</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&#x27;PID=&#x27;</span><span class="built_in">eval</span> <span class="variable">$&#123;PID&#125;</span> &amp;&amp; <span class="variable">$RESET</span>;</span><br><span class="line">	<span class="built_in">exit</span> 1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="init方法"><a href="#init方法" class="headerlink" title="init方法"></a>init方法</h2><h3 id="作用-3"><a href="#作用-3" class="headerlink" title="作用"></a>作用</h3><blockquote>
<p>完成脚本的基本参数配置，进行检查,每次运行脚本都要执行。</p>
<ul>
<li>目录、应用是否存在，不存在则提示；</li>
<li>应用是否有执行权限，没有则赋予执行权限。</li>
</ul>
</blockquote>
<h3 id="定义-3"><a href="#定义-3" class="headerlink" title="定义"></a>定义</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 初始化检查</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">init</span></span>()&#123;</span><br><span class="line">	<span class="comment">##第一步：检查文件是否存在：</span></span><br><span class="line">	<span class="keyword">if</span> [ ! -f <span class="string">&quot;<span class="variable">$keyword</span>&quot;</span> ]</span><br><span class="line">	<span class="keyword">then</span> </span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&quot;请配置检查：appname、appdir参数是否正确&quot;</span> &amp;&amp; <span class="variable">$RESET</span>;</span><br><span class="line">		<span class="built_in">exit</span> 3;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="comment">##第二步：检查文件是否可执行，进行赋权</span></span><br><span class="line">		<span class="keyword">if</span> [ ! -x <span class="string">&quot;<span class="variable">$keyword</span>&quot;</span> ]</span><br><span class="line">		<span class="keyword">then</span> </span><br><span class="line">			chmod +x <span class="string">&quot;<span class="variable">$keyword</span>&quot;</span></span><br><span class="line">		<span class="keyword">fi</span></span><br><span class="line">	<span class="keyword">fi</span> </span><br><span class="line">		</span><br><span class="line">&#125;</span><br><span class="line">init;</span><br></pre></td></tr></table></figure>



<h2 id="status方法"><a href="#status方法" class="headerlink" title="status方法"></a>status方法</h2><h3 id="作用-4"><a href="#作用-4" class="headerlink" title="作用"></a>作用</h3><blockquote>
<p>检查应用是否运行，主要对对标：systemctl、service status</p>
<p>使用指令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh app.sh status</span><br></pre></td></tr></table></figure>


</blockquote>
<h3 id="定义-4"><a href="#定义-4" class="headerlink" title="定义"></a>定义</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###检查状态</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">status</span></span>()&#123;</span><br><span class="line">		<span class="keyword">if</span> [[ $(<span class="built_in">eval</span> <span class="variable">$line</span>) -lt 2 ]]     <span class="comment">## 去除 gerp 时产生的进程</span></span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">&quot;未运行&quot;</span>    <span class="comment">#####  未执行的操作</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">&quot;正在运行&quot;</span>  <span class="comment">#####  已执行的操作</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="start方法"><a href="#start方法" class="headerlink" title="start方法"></a>start方法</h2><h3 id="作用-5"><a href="#作用-5" class="headerlink" title="作用"></a>作用</h3><blockquote>
<p>应用的启动，实现应用的检查并启动，生成pid文件，对标：systemctl、service start</p>
<p>使用指令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh app.sh start</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="定义-5"><a href="#定义-5" class="headerlink" title="定义"></a>定义</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">start</span></span>()&#123;</span><br><span class="line">		<span class="keyword">if</span> [[ $(<span class="built_in">eval</span> <span class="variable">$line</span>) -lt 2 ]]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">&quot;正在开始。。。。&quot;</span></span><br><span class="line">			<span class="built_in">eval</span> <span class="string">&quot;nohup <span class="variable">$&#123;cmd&#125;</span> &gt;&gt;<span class="variable">$&#123;output_file&#125;</span> 2&gt;&amp;1 &amp;&quot;</span></span><br><span class="line">			<span class="built_in">echo</span> $! &gt; <span class="variable">$&#123;pid_file&#125;</span>                 <span class="comment">#### 保存pid 文件</span></span><br><span class="line">			sleep 2</span><br><span class="line">			<span class="built_in">echo</span> <span class="string">&quot;成功&quot;</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">			<span class="comment">#ps aux | grep $&#123;keyword&#125; </span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">&quot;程序已经运行，请不要重复运行&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="stop方法"><a href="#stop方法" class="headerlink" title="stop方法"></a>stop方法</h2><h3 id="作用-6"><a href="#作用-6" class="headerlink" title="作用"></a>作用</h3><blockquote>
<p>应用的停止方法，实现运行应用进程的检索并杀死以及移除对应的pid文件。对标:systemctl、service stop</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh app.sh stop</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="定义-6"><a href="#定义-6" class="headerlink" title="定义"></a>定义</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">stop</span></span>()&#123;</span><br><span class="line">		<span class="keyword">if</span> [[ $(<span class="built_in">eval</span> <span class="variable">$line</span>) -lt 2 ]]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;程序未运行&quot;</span></span><br><span class="line">        <span class="keyword">elif</span> [ ! -f <span class="string">&quot;<span class="variable">$pid_file</span>&quot;</span> ]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">&quot;pid文件不存在，使用 kill 删除进程&quot;</span></span><br><span class="line">			<span class="keyword">if</span> [[ -n <span class="variable">$PID</span> ]];<span class="keyword">then</span></span><br><span class="line">				<span class="built_in">echo</span> <span class="string">&quot;准备结束,PID=<span class="variable">$PID</span>&quot;</span></span><br><span class="line">				<span class="built_in">kill</span> -9 <span class="variable">$PID</span></span><br><span class="line">				sleep 1s</span><br><span class="line">				<span class="built_in">echo</span> <span class="string">&quot;成功结束&quot;</span></span><br><span class="line">			  <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">&quot;正在停止。。。。&quot;</span></span><br><span class="line">			<span class="built_in">kill</span> -9 `cat <span class="variable">$&#123;pid_file&#125;</span>`  <span class="comment">#####  自己的停止方法 尽量不要用 kill -9</span></span><br><span class="line">			rm -f  <span class="variable">$pid_file</span></span><br><span class="line">			sleep 2</span><br><span class="line">			<span class="built_in">echo</span> <span class="string">&quot;成功&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="case模块"><a href="#case模块" class="headerlink" title="case模块"></a>case模块</h2><h3 id="作用-7"><a href="#作用-7" class="headerlink" title="作用"></a>作用</h3><blockquote>
<p>获取脚本执行参数【start、stop、status、debug、restart】，通过匹配执行相关方法。</p>
</blockquote>
<h3 id="定义-7"><a href="#定义-7" class="headerlink" title="定义"></a>定义</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">		debug):</span><br><span class="line">			debug;</span><br><span class="line">			;;</span><br><span class="line">        start):</span><br><span class="line">			start;</span><br><span class="line">			;;</span><br><span class="line">        status):</span><br><span class="line">			status;</span><br><span class="line">			;;</span><br><span class="line">        stop):</span><br><span class="line">			stop;</span><br><span class="line">			;;</span><br><span class="line">        restart):</span><br><span class="line">			stop;</span><br><span class="line">			sleep 1s;</span><br><span class="line">			start;</span><br><span class="line">			;;</span><br><span class="line">        *):</span><br><span class="line">			status;</span><br><span class="line">			<span class="built_in">echo</span> <span class="string">&quot;请输入命令: sh app.sh【start|stop|restart|status】&quot;</span></span><br><span class="line"></span><br><span class="line">			 ;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">esac</span> &amp;&amp; <span class="variable">$RESET</span></span><br></pre></td></tr></table></figure>



<h1 id="后续方向"><a href="#后续方向" class="headerlink" title="后续方向"></a>后续方向</h1><blockquote>
<p>后续实现，可以编写系统应用的init脚本，将应用注入系统，通过systemctl指令进行管理应用。</p>
</blockquote>
<h1 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line"><span class="comment"># 定义颜色动作, 把echo -e也定义到变量中</span></span><br><span class="line">RED=<span class="string">&quot;echo -en \\E[1;31m&quot;</span></span><br><span class="line">GREEN=<span class="string">&quot;echo -en \\E[1;32m&quot;</span></span><br><span class="line">YELLOW=<span class="string">&quot;echo -en \\E[1;33m&quot;</span></span><br><span class="line">RESET=<span class="string">&quot;echo -en \\E[0;39m&quot;</span></span><br><span class="line"><span class="variable">$RED</span> &amp;&amp;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;############  脚本说明 ###############################&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;脚本説明：&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;  本脚本主要用于常用工具的快速查看、启动、关闭&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;  @auth:周可新&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;  @Date:2021年4月17日&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;  详细材料请参照：https://haydenzhou.github.io/&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;使用说明（请先阅读配置使用本脚本说明）：&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;	 1.请先配置脚本配置项：&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;		必配项：appname、appdir、cmd&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;		选配项：output_file&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;	 2.指令sh app.sh 【start|stop|restart|status】&#x27;</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;############  脚本说明 ###############################&#x27;</span> &amp;&amp; <span class="variable">$RESET</span></span><br><span class="line"><span class="variable">$GREEN</span> &amp;&amp; </span><br><span class="line"><span class="comment">#############  配置项 ###############################</span></span><br><span class="line">appname=<span class="string">&#x27;natapp&#x27;</span> <span class="comment"># 程序名称</span></span><br><span class="line">appdir=<span class="string">&#x27;/data/program/natapp/&#x27;</span> <span class="comment">#应用所在目录</span></span><br><span class="line">keyword=<span class="variable">$&#123;appdir&#125;</span><span class="variable">$&#123;appname&#125;</span>   <span class="comment"># 应用全路径</span></span><br><span class="line">PID=`ps -ef |grep $(<span class="built_in">echo</span> <span class="variable">$keyword</span> | awk -F/ <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span>) | grep -v grep | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class="line">line=<span class="string">&quot;ps -ef | grep <span class="variable">$&#123;keyword&#125;</span>| wc -l&quot;</span>    <span class="comment"># 查看进程是否存在的命令  </span></span><br><span class="line">cmd=<span class="variable">$&#123;keyword&#125;</span><span class="string">&#x27; -authtoken=31b0350cb06afffc  -log=stdout&#x27;</span> <span class="comment"># nohup 执行不要带 输出重定向 和 &amp; ！！！！！！</span></span><br><span class="line">output_file=<span class="string">&#x27;/dev/null&#x27;</span>      <span class="comment">#输出重定向文件</span></span><br><span class="line">pid_file=<span class="variable">$&#123;keyword&#125;</span><span class="string">&#x27;_app.pid&#x27;</span>  <span class="comment">#pid文件 确保唯一且文件夹可写</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############  配置项 end ############################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 打印相关参数进行调试；</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">debug</span></span>()&#123;</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&#x27;打印相关参数调试&#x27;</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&#x27;keyword=&#x27;</span><span class="variable">$keyword</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&#x27;cmd=&#x27;</span><span class="variable">$cmd</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&#x27;pid_file=&#x27;</span><span class="variable">$pid_file</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&#x27;line=&#x27;</span>;	<span class="built_in">eval</span> <span class="variable">$line</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&#x27;PID=&#x27;</span><span class="built_in">eval</span> <span class="variable">$&#123;PID&#125;</span> &amp;&amp; <span class="variable">$RESET</span>;</span><br><span class="line">	<span class="built_in">exit</span> 1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">## 初始化检查</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">init</span></span>()&#123;</span><br><span class="line">	<span class="comment">##第一步：检查文件是否存在：</span></span><br><span class="line">	<span class="keyword">if</span> [ ! -f <span class="string">&quot;<span class="variable">$keyword</span>&quot;</span> ]</span><br><span class="line">	<span class="keyword">then</span> </span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&quot;请配置检查：appname、appdir参数是否正确&quot;</span> &amp;&amp; <span class="variable">$RESET</span>;</span><br><span class="line">		<span class="built_in">exit</span> 3;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="comment">##第二步：检查文件是否可执行，进行赋权</span></span><br><span class="line">		<span class="keyword">if</span> [ ! -x <span class="string">&quot;<span class="variable">$keyword</span>&quot;</span> ]</span><br><span class="line">		<span class="keyword">then</span> </span><br><span class="line">			chmod +x <span class="string">&quot;<span class="variable">$keyword</span>&quot;</span></span><br><span class="line">		<span class="keyword">fi</span></span><br><span class="line">	<span class="keyword">fi</span> </span><br><span class="line">		</span><br><span class="line">&#125;</span><br><span class="line">init;</span><br><span class="line"><span class="comment">###检查状态</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">status</span></span>()&#123;</span><br><span class="line">		<span class="keyword">if</span> [[ $(<span class="built_in">eval</span> <span class="variable">$line</span>) -lt 2 ]]     <span class="comment">## 去除 gerp 时产生的进程</span></span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">&quot;未运行&quot;</span>    <span class="comment">#####  未执行的操作</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">&quot;正在运行&quot;</span>  <span class="comment">#####  已执行的操作</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">start</span></span>()&#123;</span><br><span class="line">		<span class="keyword">if</span> [[ $(<span class="built_in">eval</span> <span class="variable">$line</span>) -lt 2 ]]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">&quot;正在开始。。。。&quot;</span></span><br><span class="line">			<span class="built_in">eval</span> <span class="string">&quot;nohup <span class="variable">$&#123;cmd&#125;</span> &gt;&gt;<span class="variable">$&#123;output_file&#125;</span> 2&gt;&amp;1 &amp;&quot;</span></span><br><span class="line">			<span class="built_in">echo</span> $! &gt; <span class="variable">$&#123;pid_file&#125;</span>                 <span class="comment">#### 保存pid 文件</span></span><br><span class="line">			sleep 2</span><br><span class="line">			<span class="built_in">echo</span> <span class="string">&quot;成功&quot;</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">			<span class="comment">#ps aux | grep $&#123;keyword&#125; </span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">&quot;程序已经运行，请不要重复运行&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">stop</span></span>()&#123;</span><br><span class="line">		<span class="keyword">if</span> [[ $(<span class="built_in">eval</span> <span class="variable">$line</span>) -lt 2 ]]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;程序未运行&quot;</span></span><br><span class="line">        <span class="keyword">elif</span> [ ! -f <span class="string">&quot;<span class="variable">$pid_file</span>&quot;</span> ]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">&quot;pid文件不存在，使用 kill 删除进程&quot;</span></span><br><span class="line">			<span class="keyword">if</span> [[ -n <span class="variable">$PID</span> ]];<span class="keyword">then</span></span><br><span class="line">				<span class="built_in">echo</span> <span class="string">&quot;准备结束,PID=<span class="variable">$PID</span>&quot;</span></span><br><span class="line">				<span class="built_in">kill</span> -9 <span class="variable">$PID</span></span><br><span class="line">				sleep 1s</span><br><span class="line">				<span class="built_in">echo</span> <span class="string">&quot;成功结束&quot;</span></span><br><span class="line">			  <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">&quot;正在停止。。。。&quot;</span></span><br><span class="line">			<span class="built_in">kill</span> -9 `cat <span class="variable">$&#123;pid_file&#125;</span>`  <span class="comment">#####  自己的停止方法 尽量不要用 kill -9</span></span><br><span class="line">			rm -f  <span class="variable">$pid_file</span></span><br><span class="line">			sleep 2</span><br><span class="line">			<span class="built_in">echo</span> <span class="string">&quot;成功&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">		debug):</span><br><span class="line">			debug;</span><br><span class="line">			;;</span><br><span class="line">        start):</span><br><span class="line">			start;</span><br><span class="line">			;;</span><br><span class="line">        status):</span><br><span class="line">			status;</span><br><span class="line">			;;</span><br><span class="line">        stop):</span><br><span class="line">			stop;</span><br><span class="line">			;;</span><br><span class="line">        restart):</span><br><span class="line">			stop;</span><br><span class="line">			sleep 1s;</span><br><span class="line">			start;</span><br><span class="line">			;;</span><br><span class="line">        *):</span><br><span class="line">			status;</span><br><span class="line">			<span class="built_in">echo</span> <span class="string">&quot;请输入命令: sh app.sh【start|stop|restart|status】&quot;</span></span><br><span class="line"></span><br><span class="line">			 ;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">esac</span> &amp;&amp; <span class="variable">$RESET</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:zhou_kexin(@).foxmail.com**(@)替换为@**">haydenzhou</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://haydenzhou.github.io/2021/10/03/linux-shell-appmanager/">https://haydenzhou.github.io/2021/10/03/linux-shell-appmanager/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://haydenzhou.github.io" target="_blank">haydenzhou小木屋</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/linux/">linux</a><a class="post-meta__tags" href="/tags/shell/">shell</a></div><div class="post_share"><div class="social-share" data-image="/img/default_cover.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/10/07/project-manager-the-oeverall-management/"><img class="prev-cover" src="/img/default_cover.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">项目管理-整体管理（最重要）</div></div></a></div><div class="next-post pull-right"><a href="/2021/09/12/readind-notes-distantmessiah/"><img class="next-cover" src="/img/default_cover.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">遥远的救世主人物关系梳理以及总结</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/08/30/centosaddISOrepo/" title="Centos配置本地镜像源"><img class="cover" src="/img/default_cover.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-30</div><div class="title">Centos配置本地镜像源</div></div></a></div><div><a href="/2021/08/31/centosinstalltelnetserver/" title="Centos安装telnet服务"><img class="cover" src="/img/default_cover.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-31</div><div class="title">Centos安装telnet服务</div></div></a></div><div><a href="/2021/06/16/linux-nameserver设置错误导致网络超时/" title="linux-nameserver设置错误导致网络超时"><img class="cover" src="/img/default_cover.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-16</div><div class="title">linux-nameserver设置错误导致网络超时</div></div></a></div><div><a href="/2021/12/23/linux-setup-nfs-server/" title="搭建linux服务器间的nfs服务"><img class="cover" src="/img/default_cover.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-23</div><div class="title">搭建linux服务器间的nfs服务</div></div></a></div><div><a href="/2021/09/09/nginx-forward-tcp-port/" title="nginx实现TCP/UDP端口转发"><img class="cover" src="/img/default_cover.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-09</div><div class="title">nginx实现TCP/UDP端口转发</div></div></a></div><div><a href="/2021/09/08/nginx-install-configuration/" title="Cent7-nginx安装与配置服务"><img class="cover" src="/img/default_cover.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-08</div><div class="title">Cent7-nginx安装与配置服务</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E"><span class="toc-number">2.</span> <span class="toc-text">使用说明</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%84%9A%E6%9C%AC%E8%A7%A3%E6%9E%90"><span class="toc-number">3.</span> <span class="toc-text">脚本解析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF"><span class="toc-number">3.1.</span> <span class="toc-text">涉及技术</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ANSI%E8%BD%AC%E4%B9%89%E5%BA%8F%E5%88%97"><span class="toc-number">3.1.1.</span> <span class="toc-text">ANSI转义序列</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%9D%90%E6%96%99%EF%BC%9A"><span class="toc-number">3.1.1.1.</span> <span class="toc-text">相关材料：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#echo%E6%8C%87%E4%BB%A4"><span class="toc-number">3.1.2.</span> <span class="toc-text">echo指令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%9D%90%E6%96%99"><span class="toc-number">3.1.2.1.</span> <span class="toc-text">相关材料</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%80%81-%E3%80%81-%E3%80%81%E2%80%99%E3%80%81%E2%80%9D%E3%80%81-%E7%94%A8%E6%B3%95"><span class="toc-number">3.1.3.</span> <span class="toc-text">$、$()、${}、’、”、&#96;用法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%9D%90%E6%96%99-1"><span class="toc-number">3.1.3.1.</span> <span class="toc-text">相关材料</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#eval"><span class="toc-number">3.1.4.</span> <span class="toc-text">eval</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%9D%90%E6%96%99-2"><span class="toc-number">3.1.4.1.</span> <span class="toc-text">相关材料</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#case"><span class="toc-number">3.1.5.</span> <span class="toc-text">case</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%9D%90%E6%96%99-3"><span class="toc-number">3.1.5.1.</span> <span class="toc-text">相关材料</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#grep"><span class="toc-number">3.1.6.</span> <span class="toc-text">grep</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%9D%90%E6%96%99-4"><span class="toc-number">3.1.6.1.</span> <span class="toc-text">相关材料</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#awk"><span class="toc-number">3.1.7.</span> <span class="toc-text">awk</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%9D%90%E6%96%99-5"><span class="toc-number">3.1.7.1.</span> <span class="toc-text">相关材料</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%9C%E8%89%B2%E5%AE%9A%E4%B9%89"><span class="toc-number">3.2.</span> <span class="toc-text">颜色定义</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8"><span class="toc-number">3.2.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89"><span class="toc-number">3.2.2.</span> <span class="toc-text">定义</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%87%E6%9C%AC%E6%8F%90%E7%A4%BA"><span class="toc-number">3.3.</span> <span class="toc-text">标本提示</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-1"><span class="toc-number">3.3.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-1"><span class="toc-number">3.3.2.</span> <span class="toc-text">定义</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#debug%E6%96%B9%E6%B3%95"><span class="toc-number">3.4.</span> <span class="toc-text">debug方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-2"><span class="toc-number">3.4.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-2"><span class="toc-number">3.4.2.</span> <span class="toc-text">定义</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#init%E6%96%B9%E6%B3%95"><span class="toc-number">3.5.</span> <span class="toc-text">init方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-3"><span class="toc-number">3.5.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-3"><span class="toc-number">3.5.2.</span> <span class="toc-text">定义</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#status%E6%96%B9%E6%B3%95"><span class="toc-number">3.6.</span> <span class="toc-text">status方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-4"><span class="toc-number">3.6.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-4"><span class="toc-number">3.6.2.</span> <span class="toc-text">定义</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#start%E6%96%B9%E6%B3%95"><span class="toc-number">3.7.</span> <span class="toc-text">start方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-5"><span class="toc-number">3.7.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-5"><span class="toc-number">3.7.2.</span> <span class="toc-text">定义</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#stop%E6%96%B9%E6%B3%95"><span class="toc-number">3.8.</span> <span class="toc-text">stop方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-6"><span class="toc-number">3.8.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-6"><span class="toc-number">3.8.2.</span> <span class="toc-text">定义</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#case%E6%A8%A1%E5%9D%97"><span class="toc-number">3.9.</span> <span class="toc-text">case模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-7"><span class="toc-number">3.9.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-7"><span class="toc-number">3.9.2.</span> <span class="toc-text">定义</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%8E%E7%BB%AD%E6%96%B9%E5%90%91"><span class="toc-number">4.</span> <span class="toc-text">后续方向</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.</span> <span class="toc-text">具体实现</span></a></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By haydenzhou</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      false && mermaid.init()
    })
  }
}</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '9Qnx0L7F76ALfhq9ezEflj5u-gzGzoHsz',
      appKey: 'xN8vqXaKifkS6M0eTSmj7wws',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'en',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>